Mss=function(q){function D(a){var b=a[0],c=b>>4,b=b&15,e=1,d;do d=a[e++];while(0!=(d&128));d=new m(c);switch(c){case g.CONNACK:d.topicNameCompressionResponse=a[e++];d.returnCode=a[e++];break;case g.PUBLISH:var c=b>>1&3,f=256*a[e]+a[e+1],e=e+2,h=z(a,e,f),e=e+f;0<c&&(d.messageIdentifier=256*a[e]+a[e+1],e+=2);a=new Mss.Message(a.subarray(e));1==(b&1)&&(a.retained=!0);8==(b&8)&&(a.duplicate=!0);a.qos=c;a.destinationName=h;d.payloadMessage=a;break;case g.PUBACK:case g.PUBREC:case g.PUBREL:case g.PUBCOMP:case g.UNSUBACK:d.messageIdentifier=
256*a[e]+a[e+1];break;case g.SUBACK:d.messageIdentifier=256*a[e]+a[e+1],d.grantedQos=a.subarray(e+2)}return d}function u(a,b,c){b[c++]=a>>8;b[c++]=a%256;return c}function p(a,b,c,e){e=u(b,c,e);A(a,c,e);return e+b}function n(a){for(var b=0,c=0;c<a.length;c++){var e=a.charCodeAt(c);2047<e?(55296<=e&&56319>=e&&(c++,b++),b+=3):127<e?b+=2:b++}return b}function A(a,b,c){for(var e=0;e<a.length;e++){var d=a.charCodeAt(e);if(55296<=d&&56319>=d){lowCharCode=a.charCodeAt(++e);if(isNaN(lowCharCode))throw Error(l(f.MALFORMED_UNICODE,
[d,lowCharCode]));d=(d-55296<<10)+(lowCharCode-56320)+65536}127>=d?b[c++]=d:(2047>=d?b[c++]=d>>6&31|192:(65535>=d?b[c++]=d>>12&15|224:(b[c++]=d>>18&7|240,b[c++]=d>>12&63|128),b[c++]=d>>6&63|128),b[c++]=d&63|128)}return b}function z(a,b,c){for(var e="",d,g=b;g<b+c;){d=a[g++];if(!(128>d)){var h=a[g++]-128;if(0>h)throw Error(l(f.MALFORMED_UTF,[d.toString(16),h.toString(16),""]));if(224>d)d=64*(d-192)+h;else{var r=a[g++]-128;if(0>r)throw Error(l(f.MALFORMED_UTF,[d.toString(16),h.toString(16),r.toString(16)]));
if(240>d)d=4096*(d-224)+64*h+r;else{var k=a[g++]-128;if(0>k)throw Error(l(f.MALFORMED_UTF,[d.toString(16),h.toString(16),r.toString(16),k.toString(16)]));if(248>d)d=262144*(d-240)+4096*h+64*r+k;else throw Error(l(f.MALFORMED_UTF,[d.toString(16),h.toString(16),r.toString(16),k.toString(16)]));}}}65535<d&&(d-=65536,e+=String.fromCharCode(55296+(d>>10)),d=56320+(d&1023));e+=String.fromCharCode(d)}return e}var g={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,
UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},w=function(a,b){for(key in a)if(a.hasOwnProperty(key))if(b.hasOwnProperty(key)){if(typeof a[key]!==b[key])throw Error(l(f.INVALID_TYPE,[typeof a[key],key]));}else{var c="Unknown property, "+key+". Valid properties are:";for(key in b)b.hasOwnProperty(key)&&(c=c+" "+key);throw Error(c);}},t=function(a,b){return function(){return a.apply(b,arguments)}},f={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},
SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error."},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},
UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},
MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},F={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},l=function(a,b){var c=a.text;if(b)for(var e=0;e<b.length;e++)if(field="{"+e+"}",start=c.indexOf(field),0<start)var d=c.substring(0,start),c=c.substring(start+field.length),
c=d+b[e]+c;return c},x=[0,6,77,81,73,115,100,112,3],m=function(a,b){this.type=a;for(name in b)b.hasOwnProperty(name)&&(this[name]=b[name])};m.prototype.encode=function(){var a=(this.type&15)<<4;remLength=0;topicStrLength=[];void 0!=this.messageIdentifier&&(remLength+=2);switch(this.type){case g.CONNECT:remLength+=x.length+3;remLength+=n(this.clientId)+2;if(void 0!=this.willMessage){remLength+=n(this.willMessage.destinationName)+2;var b=this.willMessage.payloadBytes;b instanceof Uint8Array||(b=new Uint8Array(e));
remLength+=b.byteLength+2}void 0!=this.userName&&(remLength+=n(this.userName)+2);void 0!=this.password&&(remLength+=n(this.password)+2);break;case g.SUBSCRIBE:for(var a=a|2,c=0;c<this.topics.length;c++)topicStrLength[c]=n(this.topics[c]),remLength+=topicStrLength[c]+2;remLength+=this.requestedQos.length;break;case g.UNSUBSCRIBE:a|=2;for(c=0;c<this.topics.length;c++)topicStrLength[c]=n(this.topics[c]),remLength+=topicStrLength[c]+2;break;case g.PUBLISH:this.payloadMessage.duplicate&&(a|=8);a=a|=this.payloadMessage.qos<<
1;this.payloadMessage.retained&&(a|=1);destinationNameLength=n(this.payloadMessage.destinationName);remLength+=destinationNameLength+2;var e=this.payloadMessage.payloadBytes;remLength+=e.byteLength;e instanceof ArrayBuffer?e=new Uint8Array(e):e instanceof Uint8Array||(e=new Uint8Array(e.buffer))}var d=remLength,c=Array(1),f=0;do{var h=d%128,d=d>>7;0<d&&(h|=128);c[f++]=h}while(0<d&&4>f);d=c.length+1;f=new ArrayBuffer(remLength+d);h=new Uint8Array(f);h[0]=a;h.set(c,1);this.type==g.PUBLISH?d=p(this.payloadMessage.destinationName,
destinationNameLength,h,d):this.type==g.CONNECT&&(h.set(x,d),d+=x.length,a=0,this.cleanSession&&(a=2),void 0!=this.willMessage&&(a=a|4|this.willMessage.qos<<3,this.willMessage.retained&&(a|=32)),void 0!=this.userName&&(a|=128),void 0!=this.password&&(a|=64),h[d++]=a,d=u(this.keepAliveInterval,h,d));void 0!=this.messageIdentifier&&(d=u(this.messageIdentifier,h,d));switch(this.type){case g.CONNECT:d=p(this.clientId,n(this.clientId),h,d);void 0!=this.willMessage&&(d=p(this.willMessage.destinationName,
n(this.willMessage.destinationName),h,d),d=u(b.byteLength,h,d),h.set(b,d),d+=b.byteLength);void 0!=this.userName&&(d=p(this.userName,n(this.userName),h,d));void 0!=this.password&&p(this.password,n(this.password),h,d);break;case g.PUBLISH:h.set(e,d);break;case g.SUBSCRIBE:for(c=0;c<this.topics.length;c++)d=p(this.topics[c],topicStrLength[c],h,d),h[d++]=this.requestedQos[c];break;case g.UNSUBSCRIBE:for(c=0;c<this.topics.length;c++)d=p(this.topics[c],topicStrLength[c],h,d)}return f};var B=function(a,
b,c){this._client=a;this._window=b;this._keepAliveInterval=1E3*c;this.isReset=!1;var e=(new m(g.PINGREQ)).encode(),d=function(a){return function(){return k.apply(a)}},k=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(e),this.timeout=this._window.setTimeout(d(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(f.PING_TIMEOUT.code,l(f.PING_TIMEOUT)))};this.reset=function(){this.isReset=
!0;this._window.clearTimeout(this.timeout);0<this._keepAliveInterval&&(this.timeout=setTimeout(d(this),this._keepAliveInterval))};this.cancel=function(){this._window.clearTimeout(this.timeout)}},y=function(a,b,c,e,d){this._window=b;c||(c=30);this.timeout=setTimeout(function(a,b,c){return function(){return a.apply(b,c)}}(e,a,d),1E3*c);this.cancel=function(){this._window.clearTimeout(this.timeout)}},k=function(a,b,c){if(!("WebSocket"in q&&null!==q.WebSocket))throw Error(l(f.UNSUPPORTED,["WebSocket"]));
if(!("localStorage"in q&&null!==q.localStorage))throw Error(l(f.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in q&&null!==q.ArrayBuffer))throw Error(l(f.UNSUPPORTED,["ArrayBuffer"]));this._trace("Mss.Client",a,b,c);this.host=a;this.port=b;this.clientId=c;this._localKey=a+":"+b+":"+c+":";this._msg_queue=[];this._sentMessages={};this._receivedMessages={};this._notify_msg_sent={};this._message_identifier=1;this._sequence=0;for(key in localStorage)0!=key.indexOf("Sent:"+this._localKey)&&0!=
key.indexOf("Received:"+this._localKey)||this.restore(key)};k.prototype.host;k.prototype.port;k.prototype.clientId;k.prototype.socket;k.prototype.connected=!1;k.prototype.maxMessageIdentifier=65536;k.prototype.connectOptions;k.prototype.hostIndex;k.prototype.onConnectionLost;k.prototype.onMessageDelivered;k.prototype.onMessageArrived;k.prototype._msg_queue=null;k.prototype._connectTimeout;k.prototype.sendPinger=null;k.prototype.receivePinger=null;k.prototype._traceBuffer=null;k.prototype._MAX_TRACE_ENTRIES=
100;k.prototype.connect=function(a){var b=this._traceMask(a,"password");this._trace("Client.connect",b,this.socket,this.connected);if(this.connected)throw Error(l(f.INVALID_STATE,["already connected"]));if(this.socket)throw Error(l(f.INVALID_STATE,["already connected"]));this.connectOptions=a;a.hosts?(this.hostIndex=0,this._doConnect(a.hosts[0],a.ports[0])):this._doConnect(this.host,this.port)};k.prototype.subscribe=function(a,b){this._trace("Client.subscribe",a,b);if(!this.connected)throw Error(l(f.INVALID_STATE,
["not connected"]));var c=new m(g.SUBSCRIBE);c.topics=[a];c.requestedQos=void 0!=b.qos?[b.qos]:[0];b.onSuccess&&(c.callback=function(){b.onSuccess({invocationContext:b.invocationContext})});b.timeout&&(c.timeOut=new y(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,errorCode:f.SUBSCRIBE_TIMEOUT.code,errorMessage:l(f.SUBSCRIBE_TIMEOUT)}]));this._requires_ack(c);this._schedule_message(c)};k.prototype.unsubscribe=function(a,b){this._trace("Client.unsubscribe",a,b);if(!this.connected)throw Error(l(f.INVALID_STATE,
["not connected"]));var c=new m(g.UNSUBSCRIBE);c.topics=[a];b.onSuccess&&(c.callback=function(){b.onSuccess({invocationContext:b.invocationContext})});b.timeout&&(c.timeOut=new y(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,errorCode:f.UNSUBSCRIBE_TIMEOUT.code,errorMessage:l(f.UNSUBSCRIBE_TIMEOUT)}]));this._requires_ack(c);this._schedule_message(c)};k.prototype.send=function(a){this._trace("Client.send",a);if(!this.connected)throw Error(l(f.INVALID_STATE,["not connected"]));
wireMessage=new m(g.PUBLISH);wireMessage.payloadMessage=a;0<a.qos?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage));this._schedule_message(wireMessage)};k.prototype.disconnect=function(){this._trace("Client.disconnect");if(!this.socket)throw Error(l(f.INVALID_STATE,["not connecting or connected"]));wireMessage=new m(g.DISCONNECT);this._notify_msg_sent[wireMessage]=t(this._disconnected,this);this._schedule_message(wireMessage)};
k.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date);this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(key in this._sentMessages)this._trace("_sentMessages ",key,this._sentMessages[key]);for(key in this._receivedMessages)this._trace("_receivedMessages ",key,this._receivedMessages[key]);return this._traceBuffer}};k.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]);this._trace("Client.startTrace",
new Date,"0.0.0.0")};k.prototype.stopTrace=function(){delete this._traceBuffer};k.prototype._doConnect=function(a,b){wsurl=this.connectOptions.useSSL?["wss://",a,":",b,"/mqtt"].join(""):["ws://",a,":",b,"/mqtt"].join("");this.connected=!1;this.socket=new WebSocket(wsurl,"mqttv3.1");this.socket.binaryType="arraybuffer";this.socket.onopen=t(this._on_socket_open,this);this.socket.onmessage=t(this._on_socket_message,this);this.socket.onerror=t(this._on_socket_error,this);this.socket.onclose=t(this._on_socket_close,
this);this.sendPinger=new B(this,window,this.connectOptions.keepAliveInterval);this.receivePinger=new B(this,window,this.connectOptions.keepAliveInterval);this._connectTimeout=new y(this,window,this.connectOptions.timeout,this._disconnected,[f.CONNECT_TIMEOUT.code,l(f.CONNECT_TIMEOUT)])};k.prototype._schedule_message=function(a){this._msg_queue.push(a);this.connected&&this._process_queue()};k.prototype.store=function(a,b){storedMessage={type:b.type,messageIdentifier:b.messageIdentifier,version:1};
switch(b.type){case g.PUBLISH:b.pubRecReceived&&(storedMessage.pubRecReceived=!0);storedMessage.payloadMessage={};for(var c="",e=b.payloadMessage.payloadBytes,d=0;d<e.length;d++)c=15>=e[d]?c+"0"+e[d].toString(16):c+e[d].toString(16);storedMessage.payloadMessage.payloadHex=c;storedMessage.payloadMessage.qos=b.payloadMessage.qos;storedMessage.payloadMessage.destinationName=b.payloadMessage.destinationName;b.payloadMessage.duplicate&&(storedMessage.payloadMessage.duplicate=!0);b.payloadMessage.retained&&
(storedMessage.payloadMessage.retained=!0);0==a.indexOf("Sent:")&&(void 0===b.sequence&&(b.sequence=++this._sequence),storedMessage.sequence=b.sequence);break;default:throw Error(l(f.INVALID_STORED_DATA,[key,storedMessage]));}localStorage.setItem(a+this._localKey+b.messageIdentifier,JSON.stringify(storedMessage))};k.prototype.restore=function(a){var b=localStorage.getItem(a),c=JSON.parse(b),e=new m(c.type,c);switch(c.type){case g.PUBLISH:for(var b=c.payloadMessage.payloadHex,d=new ArrayBuffer(b.length/
2),d=new Uint8Array(d),k=0;2<=b.length;){var h=parseInt(b.substring(0,2),16),b=b.substring(2,b.length);d[k++]=h}b=new Mss.Message(d);b.qos=c.payloadMessage.qos;b.destinationName=c.payloadMessage.destinationName;c.payloadMessage.duplicate&&(b.duplicate=!0);c.payloadMessage.retained&&(b.retained=!0);e.payloadMessage=b;break;default:throw Error(l(f.INVALID_STORED_DATA,[a,b]));}0==a.indexOf("Sent:"+this._localKey)?this._sentMessages[e.messageIdentifier]=e:0==a.indexOf("Received:"+this._localKey)&&
(this._receivedMessages[e.messageIdentifier]=e)};k.prototype._process_queue=function(){for(var a,b=this._msg_queue.reverse();a=b.pop();)this._socket_send(a),this._notify_msg_sent[a]&&(this._notify_msg_sent[a](),delete this._notify_msg_sent[a])};k.prototype._requires_ack=function(a){var b=Object.keys(this._sentMessages).length;if(b>this.maxMessageIdentifier)throw Error("Too many messages:"+b);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;a.messageIdentifier=
this._message_identifier;this._sentMessages[a.messageIdentifier]=a;a.type===g.PUBLISH&&this.store("Sent:",a);this._message_identifier===this.maxMessagIdentifier&&(this._message_identifier=1)};k.prototype._on_socket_open=function(){var a=new m(g.CONNECT,this.connectOptions);a.clientId=this.clientId;this._socket_send(a)};k.prototype._on_socket_message=function(a){this._trace("Client._on_socket_message",a.data);this.receivePinger.reset();a=new Uint8Array(a.data);try{var b=D(a)}catch(E){this._disconnected(f.INTERNAL_ERROR.code,
l(f.INTERNAL_ERROR,[E.message]));return}this._trace("Client._on_socket_message",b);switch(b.type){case g.CONNACK:this._connectTimeout.cancel();if(this.connectOptions.cleanSession){for(key in this._sentMessages)a=this._sentMessages[key],localStorage.removeItem("Sent:"+this._localKey+a.messageIdentifier);this._sentMessages={};for(key in this._receivedMessages)a=this._receivedMessages[key],localStorage.removeItem("Received:"+this._localKey+a.messageIdentifier);this._receivedMessages={}}if(0===b.returnCode)this.connected=
!0,this.connectOptions.hosts&&(this.hostIndex=this.connectOptions.hosts.length);else{this._disconnected(f.CONNACK_RETURNCODE.code,l(f.CONNACK_RETURNCODE,[b.returnCode,F[b.returnCode]]));break}var b=[],c;for(c in this._sentMessages)this._sentMessages.hasOwnProperty(c)&&b.push(this._sentMessages[c]);b=b.sort(function(a,b){return a.sequence-b.sequence});c=0;for(var e=b.length;c<e;c++)if(a=b[c],a.type==g.PUBLISH&&a.pubRecReceived){var d=new m(g.PUBREL,{messageIdentifier:a.messageIdentifier});this._schedule_message(d)}else this._schedule_message(a);
if(this.connectOptions.onSuccess)this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});this._process_queue();break;case g.PUBLISH:this._receivePublish(b);break;case g.PUBACK:if(a=this._sentMessages[b.messageIdentifier])if(delete this._sentMessages[b.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+b.messageIdentifier),this.onMessageDelivered)this.onMessageDelivered(a.payloadMessage);break;case g.PUBREC:if(a=this._sentMessages[b.messageIdentifier])a.pubRecReceived=
!0,d=new m(g.PUBREL,{messageIdentifier:b.messageIdentifier}),this.store("Sent:",a),this._schedule_message(d);break;case g.PUBREL:a=this._receivedMessages[b.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+b.messageIdentifier);a&&(this._receiveMessage(a),delete this._receivedMessages[b.messageIdentifier]);pubCompMessage=new m(g.PUBCOMP,{messageIdentifier:b.messageIdentifier});this._schedule_message(pubCompMessage);break;case g.PUBCOMP:a=this._sentMessages[b.messageIdentifier];
delete this._sentMessages[b.messageIdentifier];localStorage.removeItem("Sent:"+this._localKey+b.messageIdentifier);if(this.onMessageDelivered)this.onMessageDelivered(a.payloadMessage);break;case g.SUBACK:if(a=this._sentMessages[b.messageIdentifier])a.timeOut&&a.timeOut.cancel(),a.callback&&a.callback(),delete this._sentMessages[b.messageIdentifier];break;case g.UNSUBACK:if(a=this._sentMessages[b.messageIdentifier])a.timeOut&&a.timeOut.cancel(),a.callback&&a.callback(),delete this._sentMessages[b.messageIdentifier];
break;case g.PINGRESP:this.sendPinger.reset();break;case g.DISCONNECT:this._disconnected(f.INVALID_MQTT_MESSAGE_TYPE.code,l(f.INVALID_MQTT_MESSAGE_TYPE,[b.type]));break;default:this._disconnected(f.INVALID_MQTT_MESSAGE_TYPE.code,l(f.INVALID_MQTT_MESSAGE_TYPE,[b.type]))}};k.prototype._on_socket_error=function(a){this._disconnected(f.SOCKET_ERROR.code,l(f.SOCKET_ERROR,[a.data]))};k.prototype._on_socket_close=function(){this._disconnected(f.SOCKET_CLOSE.code,l(f.SOCKET_CLOSE))};k.prototype._socket_send=
function(a){if(1==a.type){var b=this._traceMask(a,"password");this._trace("Client._socket_send",b)}else this._trace("Client._socket_send",a);this.socket.send(a.encode());this.sendPinger.reset()};k.prototype._receivePublish=function(a){switch(a.payloadMessage.qos){case "undefined":case 0:this._receiveMessage(a);break;case 1:var b=new m(g.PUBACK,{messageIdentifier:a.messageIdentifier});this._schedule_message(b);this._receiveMessage(a);break;case 2:this._receivedMessages[a.messageIdentifier]=a;this.store("Received:",
a);a=new m(g.PUBREC,{messageIdentifier:a.messageIdentifier});this._schedule_message(a);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos);}};k.prototype._receiveMessage=function(a){if(this.onMessageArrived)this.onMessageArrived(a.payloadMessage)};k.prototype._disconnected=function(a,b){this._trace("Client._disconnected",a,b);this.sendPinger.cancel();this.receivePinger.cancel();this._connectTimeout&&this._connectTimeout.cancel();this._msg_queue=[];this._notify_msg_sent={};this.socket&&
(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket);if(this.connectOptions.hosts&&this.hostIndex<this.connectOptions.hosts.length-1)this.hostIndex++,this._doConnect(this.connectOptions.hosts[this.hostIndex],this.connectOptions.ports[this.hostIndex]);else if(void 0===a&&(a=f.OK.code,b=l(f.OK)),this.connected){if(this.connected=!1,this.onConnectionLost)this.onConnectionLost({errorCode:a,
errorMessage:b})}else if(this.connectOptions.onFailure)this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:a,errorMessage:b})};k.prototype._trace=function(){if(null!==this._traceBuffer)for(var a=0,b=arguments.length;a<b;a++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===a?this._traceBuffer.push(arguments[a]):"undefined"===typeof arguments[a]?this._traceBuffer.push(arguments[a]):this._traceBuffer.push("  "+JSON.stringify(arguments[a]))};
k.prototype._traceMask=function(a,b){var c={},e;for(e in a)a.hasOwnProperty(e)&&(c[e]=e==b?"******":a[e]);return c};var C=function(a,b,c){if("string"!==typeof a)throw Error(l(f.INVALID_TYPE,[typeof a,"host"]));if("number"!==typeof b||0>b)throw Error(l(f.INVALID_TYPE,[typeof b,"port"]));for(var e=0,d=0;d<c.length;d++){var g=c.charCodeAt(d);55296<=g&&56319>=g&&d++;e++}if("string"!==typeof c||1>e|23<e)throw Error(l(f.INVALID_ARGUMENT,[c,"clientId"]));var h=new k(a,b,c);this._getHost=function(){return h.host};
this._setHost=function(){throw Error(l(f.UNSUPPORTED_OPERATION));};this._getPort=function(){return h.port};this._setPort=function(){throw Error(l(f.UNSUPPORTED_OPERATION));};this._getClientId=function(){return h.clientId};this._setClientId=function(){throw Error(l(f.UNSUPPORTED_OPERATION));};this._getOnConnectionLost=function(){return h.onConnectionLost};this._setOnConnectionLost=function(a){if("function"===typeof a)h.onConnectionLost=a;else throw Error(l(f.INVALID_TYPE,[typeof a,"onConnectionLost"]));
};this._getOnMessageDelivered=function(){return h.onMessageDelivered};this._setOnMessageDelivered=function(a){if("function"===typeof a)h.onMessageDelivered=a;else throw Error(l(f.INVALID_TYPE,[typeof a,"onMessageDelivered"]));};this._getOnMessageArrived=function(){return h.onMessageArrived};this._setOnMessageArrived=function(a){if("function"===typeof a)h.onMessageArrived=a;else throw Error(l(f.INVALID_TYPE,[typeof a,"onMessageArrived"]));};this.connect=function(a){a=a||{};w(a,{timeout:"number",userName:"string",
password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object"});void 0===a.keepAliveInterval&&(a.keepAliveInterval=60);if(a.willMessage){if(!(a.willMessage instanceof v))throw Error(l(f.INVALID_TYPE,[a.willMessage,"connectOptions.willMessage"]));a.willMessage.stringPayload;if("undefined"===typeof a.willMessage.destinationName)throw Error(l(f.INVALID_TYPE,[typeof a.willMessage.destinationName,
"connectOptions.willMessage.destinationName"]));}"undefined"===typeof a.cleanSession&&(a.cleanSession=!0);if(a.hosts){if(!a.ports)throw Error(l(f.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(!(a.hosts instanceof Array))throw Error(l(f.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));if(!(a.ports instanceof Array))throw Error(l(f.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(1>a.hosts.length)throw Error(l(f.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));if(a.hosts.length!=
a.ports.length)throw Error(l(f.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));for(var b=0;b<a.hosts.length;b++){if("string"!==typeof a.hosts[b])throw Error(l(f.INVALID_TYPE,[typeof a.hosts[b],"connectOptions.hosts["+b+"]"]));if("number"!==typeof a.ports[b]||0>a.ports[b])throw Error(l(f.INVALID_TYPE,[typeof a.ports[b],"connectOptions.ports["+b+"]"]));}}h.connect(a)};this.subscribe=function(a,b){if("string"!==typeof a)throw Error("Invalid argument:"+a);b=b||{};w(b,{qos:"number",invocationContext:"object",
onSuccess:"function",onFailure:"function",timeout:"number"});if(b.timeout&&!b.onFailure)throw Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!==typeof b.qos&&0!==b.qos&&1!==b.qos&&2!==b.qos)throw Error(l(f.INVALID_ARGUMENT,[b.qos,"subscribeOptions.qos"]));h.subscribe(a,b)};this.unsubscribe=function(a,b){if("string"!==typeof a)throw Error("Invalid argument:"+a);b=b||{};w(b,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});
if(b.timeout&&!b.onFailure)throw Error("unsubscribeOptions.timeout specified with no onFailure callback.");h.unsubscribe(a,b)};this.send=function(a){if(!(a instanceof v))throw Error("Invalid argument:"+typeof a);if("undefined"===typeof a.destinationName)throw Error("Invalid parameter Message.destinationName:"+a.destinationName);h.send(a)};this.disconnect=function(){h.disconnect()};this.getTraceLog=function(){return h.getTraceLog()};this.startTrace=function(){h.startTrace()};this.stopTrace=function(){h.stopTrace()}};
C.prototype={get host(){return this._getHost()},set host(a){this._setHost(a)},get port(){return this._getPort()},set port(a){this._setPort(a)},get clientId(){return this._getClientId()},set clientId(a){this._setClientId(a)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(a){this._setOnConnectionLost(a)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(a){this._setOnMessageDelivered(a)},get onMessageArrived(){return this._getOnMessageArrived()},
set onMessageArrived(a){this._setOnMessageArrived(a)}};var v=function(a){var b;if("string"===typeof a||a instanceof ArrayBuffer||a instanceof Int8Array||a instanceof Uint8Array||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array)b=a;else throw l(f.INVALID_ARGUMENT,[a,"newPayload"]);this._getPayloadString=function(){return"string"===typeof b?b:z(b,0,b.length)};this._getPayloadBytes=function(){if("string"===
typeof b){var a=new ArrayBuffer(n(b)),a=new Uint8Array(a);A(b,a,0);return a}return b};var c=void 0;this._getDestinationName=function(){return c};this._setDestinationName=function(a){if("string"===typeof a)c=a;else throw Error(l(f.INVALID_ARGUMENT,[a,"newDestinationName"]));};var e=0;this._getQos=function(){return e};this._setQos=function(a){if(0===a||1===a||2===a)e=a;else throw Error("Invalid argument:"+a);};var d=!1;this._getRetained=function(){return d};this._setRetained=function(a){if("boolean"===
typeof a)d=a;else throw Error(l(f.INVALID_ARGUMENT,[a,"newRetained"]));};var g=!1;this._getDuplicate=function(){return g};this._setDuplicate=function(a){g=a}};v.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(a){this._setDestinationName(a)},get qos(){return this._getQos()},set qos(a){this._setQos(a)},get retained(){return this._getRetained()},set retained(a){this._setRetained(a)},
get duplicate(){return this._getDuplicate()},set duplicate(a){this._setDuplicate(a)}};return{Client:C,Message:v}}(window);
function see(d,e,f,g,h,k,l){if(window.WebSocket){var c=function(b){a.subscribe(k)},a=new Mss.Client(d,Number(e),f);a.onConnect=c;a.onMessageArrived=function(a){var b=$.Callbacks("once");b.add(l);b.fire(a.payloadString)};a.onConnectionLost=function(a){};a.connect({userName:g,password:h,onSuccess:c,onFailure:function(a){}})}else return"Your browser does not support."};
